<!DOCTYPE html>
<html>
  <head>
    <title>Despindo O Tabu</title>
    <%= csrf_meta_tags %>

    <%= stylesheet_link_tag    'application', media: 'all', 'data-turbolinks-track': 'reload' %>
    <%= javascript_include_tag 'application', 'data-turbolinks-track': 'reload' %>

    <script>
    </script>
  </head>

  <body>
    <nav class="navbar sticky-top">
      <a class="navbar-brand" href="/welcome/index.html">
        <%=image_tag("logo.svg", class: "logo")%>
      </a>
      <div class="mat-div">
      <%= form_tag(products_path, method: :get) do %>
        <%=image_submit_tag("search_icon.svg", class:'search-icon')%>
        <%=text_field_tag :term, nil,placeholder: 'Pesquise por um produto', class: 'mat-input', id: 'search' %>
      <% end %>
      </div>
      <div class = "nav-icons">
        <%=image_tag("forum_icon.svg", class: "search-icon")%>
        <a href="/subjects/">Fórum</a>

        <%# Added link to carrinho %>

        <a href = "<%=kart_items_path%>" class = "icon-link">
          <%=image_tag("carrinho_icon.svg", class: "search-icon")%>
          <% @contador = KartItem.all.count %>
          <% if @contador > 0%>
            <p class = "item-count"><%=@contador%></p>
          <% end %>
        </a>
        <%=link_to 'Carrinho', kart_items_path%>

        <%# Added block of button %>

        <div class="dropdown">
        <button type="button" class="dropbtn">
        <%=image_tag("perfil_icon.svg", class: "search-icon")%>
        Perfil
        </button>
        <div class="dropdown-content">
          <% if user_signed_in? %>
          Logged in as <strong><%= current_user.email %></strong>.
          <a class="dropdown-item"><%= button_to 'Edit profile', edit_user_registration_path, :class => 'dropdown-button' %></a>
          <a class="dropdown-item"><%= button_to "Logout", destroy_user_session_path, method: :delete, :class => 'dropdown-button'  %></a>
          <% else %>
          <a class="dropdown-item"><%= button_to "Sign up", new_user_registration_path, :class => 'dropdown-button'   %></a>
          <a class="dropdown-item"><%= button_to "Login", new_user_session_path, :class => 'dropdown-button'  %></a>
          <% end %>
        </div>
      </div>

    </nav>

    <div class = "container-fluid">
      <div class = "row">
        <% if (current_page?(products_path)) || (current_page?(categories_path)) || (current_page?('/')) %>
          <div class = "col-2 menu">
            <ul>
              <li><h3>CATEGORIAS</h3></li>
              <li><a href = "javascript:void(0);" class = "collapsible">Higiene e bem estar<%=image_tag("collapse_icon", class:"collabsable-icon")%></a></li>
              <ul class = "collapsible-content">
                <li><%= link_to 'Coletor', Category.find_by_name("Coletor") %></li>
                <li><%= link_to 'Absorvente', Category.find_by_name("Absorvente") %></li>
                <li><%= link_to 'Sabonete Intimo', Category.find_by_name("Sabonete Intimo") %></li>
                <li><%= link_to 'Desodorantes', Category.find_by_name("Desodorantes") %></li>
                <li><%= link_to 'Hidratantes', Category.find_by_name("Hidratantes") %></li>
              </ul>
              <li><a href = "javascript:void(0);" class = "collapsible">Langeries <%=image_tag("collapse_icon", class:"collabsable-icon")%></a></li>
              <ul class = "collapsible-content">
                <li><%= link_to 'Calcinha', Category.find_by_name("Calcinha") %></li>
                <li><%= link_to 'Sutiã', Category.find_by_name("Sutiã") %></li>
                <li><%= link_to 'Camisola', Category.find_by_name("Camisola") %></li>
              </ul>
              <li><%= link_to 'Preservativos', Category.find_by_name("Preservativos") %></li>
              <li><%= link_to 'Segurança', Category.find_by_name("Segurança") %></li>
              <li><%= link_to 'Acessórios', Category.find_by_name("Acessórios") %></li>
              <li><a href = "javascript:void(0);" class = "collapsible">Transição Capilar<%=image_tag("collapse_icon", class:"collabsable-icon")%></a></li>
              <ul class = "collapsible-content">
                <li><%= link_to 'Lenços', Category.find_by_name("Lenços") %></li>
                <li><%= link_to 'Perucas', Category.find_by_name("Perucas") %></li>
              </ul>
            </ul>
          </div>
          <div class = "col-10 content">
          <%# If of pages with the bar of Forum %>
        <% elsif (current_page?(commentaries_path)) || (current_page?(discussions_path)) || (current_page?(subjects_path)) %>
         <div class = "col-2 menu">
            <ul>
              <li><h3>TEMAS</h3></li>
              <li><a href = "javascript:void(0);" class = "collapsible">Higiene e bem estar<%=image_tag("collapse_icon", class:"collabsable-icon")%></a></li>
              <ul class = "collapsible-content">
                <li><%= link_to 'Coletor', Category.find_by_name("Coletor") %></li>
                <li><%= link_to 'Absorvente', Category.find_by_name("Absorvente") %></li>
                <li><%= link_to 'Sabonete Intimo', Category.find_by_name("Sabonete Intimo") %></li>
                <li><%= link_to 'Desodorantes', Category.find_by_name("Desodorantes") %></li>
                <li><%= link_to 'Hidratantes', Category.find_by_name("Hidratantes") %></li>
              </ul>
              <li><a href = "javascript:void(0);" class = "collapsible">Langeries <%=image_tag("collapse_icon", class:"collabsable-icon")%></a></li>
              <ul class = "collapsible-content">
                <li><%= link_to 'Calcinha', Category.find_by_name("Calcinha") %></li>
                <li><%= link_to 'Sutiã', Category.find_by_name("Sutiã") %></li>
                <li><%= link_to 'Camisola', Category.find_by_name("Camisola") %></li>
              </ul>
              <li><%= link_to 'Preservativos', Category.find_by_name("Preservativos") %></li>
              <li><%= link_to 'Segurança', Category.find_by_name("Segurança") %></li>
              <li><%= link_to 'Acessórios', Category.find_by_name("Acessórios") %></li>
              <li><a href = "javascript:void(0);" class = "collapsible">Transição Capilar<%=image_tag("collapse_icon", class:"collabsable-icon")%></a></li>
              <ul class = "collapsible-content">
                <li><%= link_to 'Lenços', Category.find_by_name("Lenços") %></li>
                <li><%= link_to 'Perucas', Category.find_by_name("Perucas") %></li>
              </ul>
            </ul>
          </div>
        <% else %>
          <div class = "col-12 content">
        <% end %>
          <%= yield %>
        </div>
      </div>
    </div>
  </body>
  <script>
    $(".collapsible").click(function(){
      $('.collapsible-content').each(function(){
        $(this).slideUp();
      });
      $('.collabsable-icon').each(function(){
        $(this).css({
          "-webkit-transform": "rotate(0deg)",
          "-moz-transform": "rotate(0deg)",
          "transform": "rotate(0deg)" /* For modern browsers(CSS3)  */
        });
      });
      var content = $($(this).parent()).next()[0];
      var icon = $(this).children()
      if(content.style.display != "block"){
        $(content).slideDown();
        $(icon).css({
          "-webkit-transform": "rotate(180deg)",
          "-moz-transform": "rotate(180deg)",
          "transform": "rotate(180deg)" /* For modern browsers(CSS3)  */
        });
      }
    })
    var a;
    $(document).ready(function(){
      var categoryInput = $('.category_name_parser')[0];
      if(categoryInput){
        var category = categoryInput.value;
        $( "li" ).each(function( index ) {
          if($(this).text().includes(category)){
            var aTag = $(this).children();
            var parent = $(this).parent();
            $(aTag).addClass('active');
            if($(parent).hasClass('collapsible-content')){
              var icon = $($($(parent).prev()).children()).children();
              $(parent).css( "display", "block" );
              $(icon).css({
                "-webkit-transform": "rotate(180deg)",
                "-moz-transform": "rotate(180deg)",
                "transform": "rotate(180deg)" /* For modern browsers(CSS3)  */
              });
            }
          }
        });
      }
    });
  </script>
</html>
